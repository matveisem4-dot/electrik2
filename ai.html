<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AETERNA | SPECIAL BROWSER & SERVER</title>
    <style>
        :root { --neon: #00ffcc; --dark: #020408; --accent: #bd00ff; }
        body { background: var(--dark); color: var(--neon); font-family: 'Consolas', 'Courier New', monospace; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* Экран Терминала */
        #terminal { flex: 1; padding: 25px; overflow-y: auto; background: radial-gradient(circle at center, #0a1122 0%, #020408 100%); border-bottom: 2px solid var(--accent); }
        .log-entry { margin-bottom: 15px; border-left: 2px solid var(--neon); padding-left: 15px; animation: slideIn 0.3s ease-out; }
        .server-response { border-color: var(--accent); color: #fff; background: rgba(189, 0, 255, 0.05); padding: 10px; border-radius: 4px; }
        .system-info { color: #555; font-size: 12px; margin-top: 5px; }

        /* Панель управления */
        .input-zone { padding: 25px; background: #050a14; display: flex; gap: 15px; box-shadow: 0 -10px 30px rgba(0,0,0,0.5); }
        input { flex: 1; background: transparent; border: 1px solid var(--neon); color: #fff; padding: 15px; font-size: 16px; outline: none; transition: 0.3s; }
        input:focus { box-shadow: 0 0 15px var(--neon); }
        button { background: transparent; border: 1px solid var(--accent); color: var(--accent); padding: 0 35px; cursor: pointer; font-weight: bold; text-transform: uppercase; transition: 0.3s; }
        button:hover { background: var(--accent); color: #000; box-shadow: 0 0 20px var(--accent); }

        @keyframes slideIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
        code { color: #39ff14; background: #000; padding: 2px 5px; }
    </style>
</head>
<body>

    <div id="terminal">
        <div class="log-entry">>>> СИСТЕМА AETERNA v3.0 // SECURITY KEY: 1234</div>
        <div class="log-entry">>>> ПОДКЛЮЧЕНИЕ К ГЛОБАЛЬНОМУ СЕРВЕРУ: <span style="color:white">electrik2.matveisem4.workers.dev</span></div>
    </div>

    <div class="input-zone">
        <input type="text" id="qInput" placeholder="Введите задачу (например: Напиши код или Найди кто президент)..." autocomplete="off">
        <button id="execBtn">EXECUTE</button>
    </div>

<script>
    /**
     * ЦЕНТРАЛЬНЫЙ МОЗГ AETERNA
     * Объединяет локальный спец-браузер и облачный сервер Cloudflare.
     */
    const terminal = document.getElementById('terminal');
    const input = document.getElementById('qInput');
    const btn = document.getElementById('execBtn');

    // ТВОЙ ЛИЧНЫЙ СЕРВЕР В CLOUDFLARE
    const SERVER_URL = "https://electrik2.matveisem4.workers.dev/";

    function log(text, isServer = false) {
        const d = document.createElement('div');
        d.className = `log-entry ${isServer ? 'server-response' : ''}`;
        d.innerHTML = `[${new Date().toLocaleTimeString()}] <strong>${isServer ? 'GLOBAL_SERVER' : 'LOCAL_BROWSER'}:</strong><br>${text}`;
        terminal.appendChild(d);
        terminal.scrollTop = terminal.scrollHeight;
    }

    // --- ФУНКЦИЯ СПЕЦ-БРАУЗЕРА (СМАРТ-ПОИСК БЕЗ РЕКЛАМЫ) ---
    async function specialBrowserFetch(query) {
        log(`Анализ сети по вектору: <code>${query}</code>...`);
        try {
            // Используем AllOrigins для обхода CORS и получения сырого HTML
            const proxy = `https://api.allorigins.win/get?url=`;
            const target = encodeURIComponent(`https://www.google.com/search?q=${query}`);
            
            const response = await fetch(proxy + target);
            if (!response.ok) throw new Error("Сеть недоступна");
            
            const json = await response.json();
            
            // Очистка контента (Удаляем рекламу, скрипты, навигацию)
            const parser = new DOMParser();
            const doc = parser.parseFromString(json.contents, 'text/html');
            
            // Удаляем мусорные теги
            const trash = doc.querySelectorAll('script, style, iframe, footer, nav, .ads, .ad, [role="banner"]');
            trash.forEach(el => el.remove());

            // Извлекаем только "Самые лучшие слова" (Чистый текст)
            const cleanText = doc.body.innerText
                .replace(/\s+/g, ' ') // Убираем лишние пробелы
                .substring(0, 1500); // Берем первые 1500 символов для анализа
            
            log("Мусор отсеян. Пакет данных готов для передачи в Cloudflare.");
            return cleanText;
        } catch (e) {
            log("Ошибка сенсоров: " + e.message);
            return "NO_DATA";
        }
    }

    // --- ГЛАВНЫЙ ПРОЦЕСС ---
    async function runAeterna() {
        const query = input.value.trim();
        if(!query) return;
        input.value = '';

        log(`Инициация директивы: "<u>${query}</u>"`, false);

        // 1. Работает Спец-Браузер (Локально)
        const scrapedData = await specialBrowserFetch(query);

        // 2. Сигнал на Огромный Сервер (Cloudflare)
        log("Синхронизация с облачным ядром...");
        
        try {
            const serverResponse = await fetch(SERVER_URL, {
                method: 'POST',
                headers: {
                    'Authorization': '1234',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    query: query,
                    data: scrapedData
                })
            });

            if (!serverResponse.ok) {
                if(serverResponse.status === 403) throw new Error("Ошибка ключа доступа 1234");
                throw new Error("Сервер не отвечает");
            }

            const result = await serverResponse.json();
            
            // Вывод финального умного ответа
            log(`<strong>СТАТУС: ${result.verdict}</strong><br>${result.summary}<br><div class="system-info">Интеллект: ${result.intellect_level}</div>`, true);

        } catch (err) {
            log(`КРИТИЧЕСКАЯ ОШИБКА: ${err.message}. Проверь, нажал ли ты кнопку "Deploy" в Cloudflare.`, true);
        }
    }

    // Слушатели событий
    btn.onclick = runAeterna;
    input.onkeypress = (e) => { if(e.key === 'Enter') runAeterna(); };
</script>
</body>
</html>
