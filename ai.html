<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberMind Offline</title>
    <style>
        body { background: #0b0e14; color: #fff; font-family: sans-serif; display: flex; flex-direction: column; height: 100vh; margin: 0; }
        #chat { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px 15px; border-radius: 15px; max-width: 80%; }
        .user { align-self: flex-end; background: #0088cc; }
        .ai { align-self: flex-start; background: #2a2f3d; }
        .input-box { padding: 20px; background: #1a1f29; display: flex; gap: 10px; }
        input { flex: 1; padding: 12px; border-radius: 10px; border: none; background: #0d1117; color: #fff; }
        button { background: #0088cc; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; }
        #status { font-size: 12px; color: #58a6ff; padding: 5px 20px; }
    </style>
</head>
<body>

<div id="status">Инициализация локального мозга (WebGPU)...</div>
<div id="chat">
    <div class="msg ai">Я работаю прямо на твоем устройстве. Без интернета. Без хостинга. Без цензуры.</div>
</div>

<div class="input-area">
    <div id="progress"></div>
    <div class="input-box">
        <input type="text" id="user-input" placeholder="Напиши что-нибудь...">
        <button id="send-btn">ОК</button>
    </div>
</div>

<script type="module">
    // Мы используем библиотеку Transformers.js, которая позволяет запускать ИИ прямо в браузере
    import { pipeline } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1';

    let generator;
    const status = document.getElementById('status');
    const chat = document.getElementById('chat');
    const input = document.getElementById('user-input');
    const btn = document.getElementById('send-btn');

    // Загрузка модели прямо в браузер
    async function init() {
        try {
            status.innerText = "Загрузка микро-мозга (130МБ)... Это только один раз.";
            // Используем SmolLM-135M - супер-маленькая и быстрая модель
            generator = await pipeline('text-generation', 'Xenova/SmolLM-135M-Instruct');
            status.innerText = "ИИ готов. Работаю на твоей видеокарте.";
        } catch (e) {
            status.innerText = "Ошибка: твой браузер слишком старый или не поддерживает WebGPU.";
        }
    }

    async function send() {
        const text = input.value;
        if (!text || !generator) return;

        addMsg(text, 'user');
        input.value = '';
        status.innerText = "CyberMind думает...";

        const output = await generator(text, { 
            max_new_tokens: 50, 
            temperature: 0.7,
            repetition_penalty: 1.2
        });

        addMsg(output[0].generated_text.replace(text, '').trim(), 'ai');
        status.innerText = "Готов.";
    }

    function addMsg(txt, side) {
        const d = document.createElement('div');
        d.className = `msg ${side}`;
        d.innerText = txt;
        chat.appendChild(d);
        chat.scrollTop = chat.scrollHeight;
    }

    btn.onclick = send;
    input.onkeydown = (e) => { if(e.key === 'Enter') send(); };
    
    init();
</script>
</body>
</html>
