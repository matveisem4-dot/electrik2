<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>AETERNA | NETWORK NODE</title>
    <style>
        :root { --neon: #00ffcc; --alert: #ff0055; --bg: #050505; }
        body { margin: 0; background: var(--bg); color: var(--neon); font-family: 'Courier New', monospace; display: flex; flex-direction: column; height: 100vh; }
        
        /* Заголовок сети */
        header { padding: 15px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; font-size: 12px; background: #0a0a0a; }
        .status-node { color: #fff; background: #222; padding: 3px 8px; border-radius: 3px; }
        .status-ok { border-bottom: 2px solid var(--neon); }

        /* Терминал */
        #terminal { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px; background: rgba(0, 255, 204, 0.05); border-left: 2px solid var(--neon); animation: fadeIn 0.3s; }
        .msg.server { border-color: var(--alert); color: #fff; background: rgba(255, 0, 85, 0.05); }
        .msg.user { border-color: #555; color: #aaa; }
        
        /* Ввод */
        .controls { padding: 20px; background: #0a0a0a; display: flex; gap: 10px; border-top: 1px solid #222; }
        input { flex: 1; background: #000; border: 1px solid var(--neon); color: #fff; padding: 15px; font-family: inherit; font-size: 14px; outline: none; }
        button { background: var(--neon); color: #000; border: none; padding: 0 30px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        button:hover { background: #fff; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <header>
        <div>NODE: LOCAL_MINI_SERVER</div>
        <div>AUTH: <span id="auth-status">CHECKING...</span></div>
        <div class="status-node status-ok">GLOBAL SERVER: STANDBY</div>
    </header>

    <div id="terminal">
        <div class="msg">[LOCAL]: Система инициализирована. Локальный кэш пуст. Подключение к сети установлено.</div>
    </div>

    <div class="controls">
        <input type="text" id="userInput" placeholder="Введите запрос..." autocomplete="off">
        <button id="sendBtn">SEND</button>
    </div>

    <script>
        const terminal = document.getElementById('terminal');
        const input = document.getElementById('userInput');
        const btn = document.getElementById('sendBtn');
        const authStatus = document.getElementById('auth-status');

        // Секретный пароль интегрирован напрямую в логику мини-сервера
        const userPass = "1234"; 
        
        // Авторизация при старте
        setTimeout(() => {
            authStatus.innerText = `GRANTED (KEY: ${userPass})`;
            authStatus.style.color = "var(--neon)";
        }, 800);

        // Функция вывода текста в консоль
        function printLog(text, type = 'local') {
            const div = document.createElement('div');
            div.className = `msg ${type}`;
            
            let prefix = "[LOCAL A.I.]: ";
            if (type === 'server') prefix = "[GLOBAL SERVER]: ";
            if (type === 'user') prefix = "[USER]: ";

            div.innerHTML = `<strong>${prefix}</strong>${text}`;
            terminal.appendChild(div);
            terminal.scrollTop = terminal.scrollHeight;
        }

        // Локальные мозги (то, что знает мини-сервер без интернета)
        const localKnowledge = {
            "привет": "Приветствую. Я локальный узел системы.",
            "очистить": "Выполняю очистку терминала."
        };

        // Функция обращения к ОГРОМНОМУ СЕРВЕРУ
        async function fetchFromServer(query) {
            printLog("Локальных данных недостаточно. Открываю канал связи с GLOBAL SERVER...", "local");
            
            try {
                // Имитация задержки сети (пинга)
                await new Promise(r => setTimeout(r, 800)); 

                // ЗАПРОС К ФАЙЛУ НА ГИТХАБЕ (Замени URL на свой, если нужно)
                // Сейчас он обращается к локальному файлу server_brain.json
                const response = await fetch('./server_brain.json'); 
                
                if (!response.ok) throw new Error("Сервер не отвечает.");
                
                const data = await response.json();
                const db = data.knowledge_base;

                // Ищем ответ в глобальной базе
                let answer = null;
                for (let key in db) {
                    if (query.includes(key)) {
                        answer = db[key];
                        break;
                    }
                }

                // Если глобальный сервер тоже не знает
                if (!answer) {
                    const fallbacks = data.fallback_responses;
                    answer = fallbacks[Math.floor(Math.random() * fallbacks.length)];
                }

                printLog(answer, "server");

            } catch (error) {
                printLog(`ОШИБКА СВЯЗИ: Не удалось загрузить server_brain.json. Проверь наличие файла на GitHub.`, "server");
            }
        }

        // Главный процессор обработки
        async function processInput() {
            const text = input.value.trim().toLowerCase();
            if (!text) return;

            printLog(input.value, 'user');
            input.value = '';

            // 1. Проверяем локальные знания (Мини-сервер)
            if (text === "очистить") {
                terminal.innerHTML = '';
                return;
            }

            let localAnswer = null;
            for (let key in localKnowledge) {
                if (text.includes(key)) localAnswer = localKnowledge[key];
            }

            if (localAnswer) {
                // Отвечает мини-сервер
                printLog(localAnswer, 'local');
            } else {
                // 2. Отправляем запрос на огромный сервер
                await fetchFromServer(text);
            }
        }

        btn.addEventListener('click', processInput);
        input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') processInput();
        });
    </script>
</body>
</html>
