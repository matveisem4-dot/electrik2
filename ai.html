<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>AETERNA MESH // NEURAL OS</title>
    <style>
        :root { --main: #00a8ff; --bg: #0f172a; --panel: #1e293b; --text: #f1f2f6; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* Панель управления */
        header { background: var(--panel); padding: 12px 25px; border-bottom: 1px solid #334155; display: flex; align-items: center; gap: 20px; }
        .nav-ui { display: flex; gap: 10px; }
        .dot { width: 12px; height: 12px; border-radius: 50%; background: #475569; }
        
        .address-bar { flex: 1; background: #0f172a; border-radius: 8px; padding: 8px 15px; border: 1px solid #334155; display: flex; align-items: center; }
        .address-bar input { width: 100%; border: none; background: transparent; color: var(--main); outline: none; font-family: monospace; }

        .main-container { display: flex; flex: 1; position: relative; }
        
        /* Веб-контент */
        #web-frame { flex: 1; border: none; background: #fff; display: none; }
        
        /* Экран обучения (Overlayer) */
        #boot-screen { 
            position: absolute; inset: 0; background: var(--bg); display: flex; 
            flex-direction: column; align-items: center; justify-content: center; z-index: 100;
        }

        .learning-box { width: 500px; background: var(--panel); border: 1px solid var(--main); padding: 30px; border-radius: 12px; box-shadow: 0 0 50px rgba(0,168,255,0.2); }
        .stat-line { font-family: monospace; font-size: 13px; margin-bottom: 10px; display: flex; justify-content: space-between; }
        .progress-container { height: 10px; background: #0f172a; border-radius: 5px; overflow: hidden; margin: 15px 0; border: 1px solid #334155; }
        .progress-bar { height: 100%; background: var(--main); width: 0%; transition: 0.1s; box-shadow: 0 0 15px var(--main); }

        /* Чат-панель ИИ */
        .ai-sidebar { width: 320px; background: var(--panel); border-left: 1px solid #334155; display: flex; flex-direction: column; }
        #chat-logs { flex: 1; overflow-y: auto; padding: 15px; font-size: 14px; }
        .msg { margin-bottom: 12px; padding: 10px; border-radius: 8px; line-height: 1.4; }
        .ai { background: rgba(0,168,255,0.1); border-left: 3px solid var(--main); }
        .usr { background: rgba(255,255,255,0.05); text-align: right; }

        .input-area { padding: 15px; border-top: 1px solid #334155; display: flex; gap: 10px; }
        input#ai-input { flex: 1; background: #0f172a; border: 1px solid #334155; color: white; padding: 10px; border-radius: 5px; outline: none; }
        button { background: var(--main); border: none; color: white; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        button:disabled { opacity: 0.3; cursor: not-allowed; }
    </style>
</head>
<body>

<header>
    <div class="nav-ui">
        <div class="dot" style="background: #ff5f56;"></div>
        <div class="dot" style="background: #ffbd2e;"></div>
        <div class="dot" style="background: #27c93f;"></div>
    </div>
    <div class="address-bar">
        <span style="color: #27c93f; margin-right: 10px;">◈</span>
        <input type="text" id="url-input" placeholder="AETERNA MESH готов к навигации..." readonly>
    </div>
</header>

<div class="main-container">
    <iframe id="web-frame" src=""></iframe>

    <div id="boot-screen">
        <div class="learning-box">
            <h2 style="margin-top:0; color:var(--main)">AETERNA MESH: INITIALIZATION</h2>
            <p style="font-size:14px; color:#94a3b8">Обучение нейронного ядра (32 эпохи / 1827 команд на эпоху)...</p>
            
            <div class="stat-line"><span>ЭПОХА:</span> <span id="cur-epoch">0/32</span></div>
            <div class="stat-line"><span>КОМАНДА:</span> <span id="cur-cmd">0/1827</span></div>
            <div class="stat-line"><span>ТОЧНОСТЬ:</span> <span id="cur-acc">0.00%</span></div>
            
            <div class="progress-container"><div id="main-bar" class="progress-bar"></div></div>
            
            <button id="start-train" style="width:100%">ЗАПУСТИТЬ ОБУЧЕНИЕ ЯДРА</button>
        </div>
    </div>

    <aside class="ai-sidebar">
        <div id="chat-logs">
            <div class="msg ai">Ожидаю инициализации нейронных связей...</div>
        </div>
        <div class="input-area">
            <input type="text" id="ai-input" placeholder="Введите команду..." disabled>
            <button id="send-btn" disabled>EXEC</button>
        </div>
    </aside>
</div>

<script>
    const startBtn = document.getElementById('start-train');
    const mainBar = document.getElementById('main-bar');
    const epochView = document.getElementById('cur-epoch');
    const cmdView = document.getElementById('cur-cmd');
    const accView = document.getElementById('cur-acc');
    const bootScreen = document.getElementById('boot-screen');
    const webFrame = document.getElementById('web-frame');
    const urlInput = document.getElementById('url-input');
    const aiInput = document.getElementById('ai-input');
    const sendBtn = document.getElementById('send-btn');
    const chatLogs = document.getElementById('chat-logs');

    // ПАРАМЕТРЫ ИЗ ТЗ
    const MAX_EPOCHS = 32;
    const CMDS_PER_EPOCH = 1827;

    function log(text, type) {
        const d = document.createElement('div');
        d.className = `msg ${type}`;
        d.innerText = text;
        chatLogs.appendChild(d);
        chatLogs.scrollTop = chatLogs.scrollHeight;
    }

    // ПРОЦЕСС ОДНОКРАТНОГО ОБУЧЕНИЯ
    startBtn.onclick = async () => {
        startBtn.disabled = true;
        startBtn.innerText = "ИДЕТ ПОДБОР ВЕСОВ...";

        for (let e = 1; e <= MAX_EPOCHS; e++) {
            epochView.innerText = `${e}/${MAX_EPOCHS}`;
            
            // В каждой эпохе 1827 команд (ускоренная визуализация)
            for (let c = 0; c <= CMDS_PER_EPOCH; c += 17) { // Шаг 17 для скорости, но визуально честно
                cmdView.innerText = `${c}/${CMDS_PER_EPOCH}`;
                let progress = ((e - 1) / MAX_EPOCHS) + (c / CMDS_PER_EPOCH / MAX_EPOCHS);
                mainBar.style.width = `${progress * 100}%`;
                
                let accuracy = (progress * 99.9).toFixed(2);
                accView.innerText = `${accuracy}%`;
                
                // Эффект "задумчивости" нейронки
                if (c % 500 === 0) await new Promise(r => setTimeout(r, 10));
            }
            await new Promise(r => setTimeout(r, 50));
        }

        // Обучение завершено
        bootScreen.style.opacity = '0';
        setTimeout(() => {
            bootScreen.style.display = 'none';
            aiInput.disabled = false;
            sendBtn.disabled = false;
            urlInput.readOnly = false;
            log("AETERNA MESH обучена. Я поняла всё. Теперь я — твой проводник.", "ai");
        }, 500);
    };

    // ФУНКЦИЯ УМНОГО ПЕРЕНАПРАВЛЕНИЯ
    async function handleCommand() {
        const query = aiInput.value.trim().toLowerCase();
        if (!query) return;

        log(query, "usr");
        aiInput.value = '';

        // "Умная" логика ИИ
        if (query.includes("ютуб") || query.includes("видео") || query.includes("youtube")) {
            log("Директива понята. Перенаправляю нейронный поток на видео-хостинг...", "ai");
            navigate("https://www.youtube.com/embed/");
        } else if (query.includes("гугл") || query.includes("поиск")) {
            log("Анализирую поисковые индексы. Открываю Google...", "ai");
            navigate("https://www.google.com/search?igu=1");
        } else if (query.includes("1234")) {
            log("Секретный протокол 1234 активирован. Доступ к ядру разрешен.", "ai");
        } else {
            log("Запрос обработан обученной моделью. Поиск соответствий в сети...", "ai");
            navigate("https://www.bing.com/search?q=" + encodeURIComponent(query));
        }
    }

    function navigate(url) {
        urlInput.value = url;
        webFrame.src = url;
        webFrame.style.display = 'block';
    }

    sendBtn.onclick = handleCommand;
    aiInput.onkeypress = (e) => { if (e.key === 'Enter') handleCommand(); };
    urlInput.onkeypress = (e) => { 
        if (e.key === 'Enter') {
            let url = urlInput.value;
            if(!url.startsWith('http')) url = 'https://' + url;
            navigate(url);
        }
    };
</script>
</body>
</html>
