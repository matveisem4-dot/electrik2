<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>FearConnect WS Edition</title>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .card { background: #111; padding: 30px; border-radius: 20px; width: 300px; border: 1px solid #333; }
        input { width: 100%; padding: 12px; margin: 10px 0; background: #000; border: 1px solid #444; color: #fff; border-radius: 8px; }
        button { width: 100%; padding: 12px; background: #ff3b30; border: none; color: #fff; font-weight: bold; border-radius: 8px; cursor: pointer; }
        #status { font-size: 12px; margin-top: 10px; color: orange; }
    </style>
</head>
<body>

<div id="auth-screen" class="card">
    <h2>FEAR WS</h2>
    <input type="text" id="log-in" placeholder="ID Агента">
    <input type="password" id="pass-in" placeholder="Пароль">
    <button onclick="doAuth(true)">СОЗДАТЬ АККАУНТ</button>
    <button onclick="doAuth(false)" style="background:none; border:1px solid #333; margin-top:5px;">ВОЙТИ</button>
    <div id="status">Подключение...</div>
</div>

<div id="chat-screen" style="display:none; width: 100%; max-width: 400px;">
    <div id="msgs" style="height: 300px; overflow-y: auto; background: #111; padding: 20px; border-radius: 10px; margin-bottom: 10px;"></div>
    <input type="text" id="msg-to" placeholder="Кому (ID)">
    <input type="text" id="msg-text" placeholder="Сообщение...">
    <button onclick="send()">ОТПРАВИТЬ</button>
</div>

<script>
    // МЕНЯЕМ https:// на wss:// для библиотеки WS [cite: 2026-02-06]
    const S_URL = "wss://matvey228552858258489842494-fearconnect.hf.space";
    let ws;

    function connect() {
        ws = new WebSocket(S_URL);

        ws.onopen = () => {
            document.getElementById('status').innerText = "Статус: В сети";
            document.getElementById('status').style.color = "green";
        };

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.type === 'auth_success') {
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('chat-screen').style.display = 'block';
            }
            if (data.type === 'auth_error') alert(data.error);
            if (data.type === 'new_msg') {
                const div = document.createElement('div');
                div.innerText = `${data.from}: ${data.text}`;
                document.getElementById('msgs').appendChild(div);
            }
        };

        ws.onclose = () => {
            document.getElementById('status').innerText = "Статус: Разрыв. Переподключение...";
            setTimeout(connect, 3000);
        };
    }

    function doAuth(isReg) {
        const login = document.getElementById('log-in').value;
        const pass = document.getElementById('pass-in').value;
        ws.send(JSON.stringify({ type: 'auth', login, pass, isReg }));
    }

    function send() {
        const to = document.getElementById('msg-to').value;
        const text = document.getElementById('msg-text').value;
        ws.send(JSON.stringify({ type: 'msg', to, text }));
        document.getElementById('msg-text').value = "";
    }

    connect();
</script>
</body>
</html>
