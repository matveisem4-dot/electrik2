<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>FearConnect v35 | Fixed</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        :root { --red: #ff3b30; --bg: #050505; --panel: #121214; --border: #252529; }
        * { box-sizing: border-box; outline: none; font-family: 'Segoe UI', sans-serif; }
        body { margin: 0; background: var(--bg); color: #fff; overflow: hidden; }
        #auth-screen { position: fixed; inset: 0; background: #000; z-index: 1000; display: flex; align-items: center; justify-content: center; }
        .m-card { background: var(--panel); border: 1px solid var(--border); padding: 40px; border-radius: 30px; width: 360px; text-align: center; }
        .inp { width: 100%; background: #000; border: 1px solid var(--border); color: #fff; padding: 15px; margin: 10px 0; border-radius: 12px; }
        .btn { background: var(--red); color: #fff; border: none; padding: 16px; width: 100%; border-radius: 12px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        #app { display: none; height: 100vh; grid-template-columns: 280px 1fr; }
        #sidebar { background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .side-head { padding: 25px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        #list { flex: 1; overflow-y: auto; padding: 10px; }
        .f-item { padding: 15px; margin-bottom: 5px; cursor: pointer; border-radius: 12px; display: flex; align-items: center; gap: 10px; }
        .f-item.active { background: rgba(255,59,48,0.1); color: var(--red); font-weight: bold; }
        #chat { display: flex; flex-direction: column; background: #080808; }
        #msgs { flex: 1; overflow-y: auto; padding: 25px; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 12px 16px; border-radius: 18px; max-width: 75%; font-size: 14px; }
        .out { align-self: flex-end; background: var(--red); }
        .in { align-self: flex-start; background: #1c1c1e; }
        #inp-p { padding: 20px; background: var(--panel); border-top: 1px solid var(--border); display: none; gap: 10px; }
        #m-in { flex: 1; background: #000; border: 1px solid var(--border); color: #fff; padding: 12px; border-radius: 20px; }
    </style>
</head>
<body>

<div id="auth-screen">
    <div class="m-card">
        <h2 style="color:var(--red); margin:0;">FEARCONNECT</h2>
        <p id="auth-mode-text" style="font-size: 12px; color: #555; margin-bottom: 25px;">–í–•–û–î –í –°–ò–°–¢–ï–ú–£</p>
        <input type="text" id="alog" class="inp" placeholder="ID –ê–ì–ï–ù–¢–ê">
        <input type="password" id="apass" class="inp" placeholder="–ü–ê–†–û–õ–¨">
        <button class="btn" id="main-btn" onclick="handleAuth()">–í–û–ô–¢–ò</button>
        <div style="margin-top: 20px; font-size: 12px;">
            <span id="switch-text">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?</span> 
            <a href="#" onclick="toggleMode()" id="switch-link" style="color:var(--red); text-decoration:none; font-weight:bold;">–°–æ–∑–¥–∞—Ç—å</a>
        </div>
    </div>
</div>

<div id="app">
    <div id="sidebar">
        <div class="side-head"><b style="color:var(--red)">FEAR.NET</b> <button onclick="alert('–ü–æ–∏—Å–∫...')" style="background:none; border:none; color:#fff; cursor:pointer; font-size:20px;">+</button></div>
        <div id="list"></div>
    </div>
    <div id="chat">
        <div style="padding:20px; border-bottom:1px solid var(--border);"><b id="chat-title">–°–ò–°–¢–ï–ú–ê</b></div>
        <div id="msgs"></div>
        <div id="inp-p">
            <input type="text" id="m-in" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
            <button onclick="send()" style="background:var(--red); border:none; color:#fff; width:40px; height:40px; border-radius:50%; cursor:pointer;">‚û§</button>
        </div>
    </div>
</div>

<script>
    const S_URL = "https://matvey228552858258489842494-fearconnect.hf.space";
    let socket = io(S_URL), me = "", activePeer = "SYSTEM", isRegMode = false;

    function toggleMode() {
        isRegMode = !isRegMode;
        document.getElementById('auth-mode-text').innerText = isRegMode ? "–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –ù–û–í–û–ì–û –ê–ì–ï–ù–¢–ê" : "–í–•–û–î –í –°–ò–°–¢–ï–ú–£";
        document.getElementById('main-btn').innerText = isRegMode ? "–ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–¢–¨–°–Ø" : "–í–û–ô–¢–ò";
        document.getElementById('switch-text').innerText = isRegMode ? "–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?" : "–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?";
        document.getElementById('switch-link').innerText = isRegMode ? "–í–æ–π—Ç–∏" : "–°–æ–∑–¥–∞—Ç—å";
    }

    function handleAuth() {
        const login = document.getElementById('alog').value.trim();
        const pass = document.getElementById('apass').value.trim();
        if(!login || !pass) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è");
        socket.emit('auth', { login, pass, isReg: isRegMode });
    }

    socket.on('auth_success', (data) => {
        me = data.login;
        document.getElementById('auth-screen').style.display = 'none';
        document.getElementById('app').style.display = 'grid';
        setChat('SYSTEM');
    });

    socket.on('auth_error', (err) => alert(err));

    function send() {
        const i = document.getElementById('m-in');
        if(!i.value) return;
        socket.emit('send_msg', { from: me, to: activePeer, text: i.value });
        i.value = '';
    }

    socket.on('new_msg', m => {
        if(m.from === activePeer || m.from === me || (m.to === me && activePeer === m.from)) renderMsg(m);
    });

    socket.on('load_history', h => {
        document.getElementById('msgs').innerHTML = "";
        h.forEach(m => {
            if((m.from === me && m.to === activePeer) || (m.from === activePeer && m.to === me)) renderMsg(m);
        });
    });

    function renderMsg(m) {
        const d = document.createElement('div');
        d.className = `msg ${m.from === me ? 'out' : 'in'}`;
        d.innerText = m.text;
        document.getElementById('msgs').appendChild(d);
        document.getElementById('msgs').scrollTop = 99999;
    }

    socket.on('update_friends', list => {
        const l = document.getElementById('list');
        l.innerHTML = `<div class="f-item ${activePeer==='SYSTEM'?'active':''}" onclick="setChat('SYSTEM')">üì¢ –°–ò–°–¢–ï–ú–ê</div>`;
        list.forEach(u => { if(u !== me) l.innerHTML += `<div class="f-item ${activePeer===u?'active':''}" onclick="setChat('${u}')">üë§ ${u}</div>`; });
    });

    function setChat(p) {
        activePeer = p;
        document.getElementById('chat-title').innerText = p;
        document.getElementById('inp-p').style.display = p === 'SYSTEM' ? 'none' : 'flex';
        // –ù–µ –ø–µ—Ä–µ–∑–∞—Ö–æ–¥–∏–º, –∞ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ—Å–∏–º –∏—Å—Ç–æ—Ä–∏—é
        socket.emit('auth', { login: me, pass: "checked", isReg: false });
    }
</script>
</body>
</html>
