<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NeuroEngine X - Monolith</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        body { background: #020202; color: #fff; font-family: 'Inter', sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        .chat-area { flex: 1; overflow-y: auto; padding: 20px; scrollbar-width: none; }
        .chat-area::-webkit-scrollbar { display: none; }
        .message-fade { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .input-container { background: #0a0a0a; border-top: 1px solid #1a1a1a; padding: 15px; display: flex; gap: 10px; align-items: center; }
        input { flex: 1; background: #121212; border: 1px solid #222; border-radius: 12px; padding: 12px 16px; color: #fff; outline: none; transition: 0.3s; }
        input:focus { border-color: #4f46e5; }
        #lock-screen { position: fixed; inset: 0; background: #020202; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .loader { width: 12px; height: 12px; background: #4f46e5; border-radius: 50%; display: none; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.5); opacity: 0.5; } 100% { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>

    <div id="lock-screen">
        <div class="w-16 h-16 bg-indigo-600 rounded-2xl flex items-center justify-center mb-6 shadow-2xl shadow-indigo-500/20">
            <i class="fas fa-brain text-white text-3xl"></i>
        </div>
        <input type="password" id="passCode" class="bg-zinc-900 border border-zinc-800 rounded-xl p-3 text-center mb-4 outline-none focus:border-indigo-500 transition" placeholder="ENTER CODE">
        <button onclick="unlock()" class="text-[10px] font-bold text-indigo-400 tracking-widest uppercase hover:text-white transition">Initialize Monolith</button>
    </div>

    <header class="h-16 px-6 flex items-center justify-between border-b border-white/5 bg-black/40 backdrop-blur-md">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center font-black">X</div>
            <h1 class="font-bold text-xs uppercase tracking-widest">NeuroEngine Monolith</h1>
        </div>
        <div id="status" class="text-[9px] font-bold text-green-500 border border-green-500/30 px-2 py-1 rounded uppercase">Server-Side Ready</div>
    </header>

    <div id="chat" class="chat-area space-y-4">
        <div class="bg-indigo-600/10 border border-indigo-600/20 p-4 rounded-2xl text-xs text-indigo-300 message-fade">
            [SYSTEM]: Облачный узел активирован. Вычислений на устройстве: 0%. Мозги запущены на сервере.
        </div>
    </div>

    <div class="px-6 py-2 flex items-center gap-2">
        <div id="ai-loader" class="loader"></div>
    </div>

    <div class="input-container">
        <input type="text" id="userInput" placeholder="Введите ваш запрос...">
        <button onclick="handleSend()" class="w-12 h-12 bg-indigo-600 rounded-xl flex items-center justify-center hover:bg-indigo-500 transition">
            <i class="fas fa-arrow-up"></i>
        </button>
    </div>

    <script>
        function unlock() {
            if(document.getElementById('passCode').value === "1234") {
                document.getElementById('lock-screen').style.opacity = '0';
                setTimeout(() => document.getElementById('lock-screen').remove(), 500);
            } else { alert("ACCESS DENIED"); }
        }

        async function handleSend() {
            const input = document.getElementById('userInput');
            const chat = document.getElementById('chat');
            const loader = document.getElementById('ai-loader');
            const val = input.value.trim();
            
            if(!val) return;

            // Добавляем сообщение пользователя
            addMsg(val, 'user');
            input.value = "";
            loader.style.display = 'block';

            try {
                // Запрос к нашему серверу на Vercel
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: val })
                });

                const data = await response.json();
                addMsg(data.text || data.error, 'ai');
            } catch (e) {
                addMsg("Критическая ошибка связи с сервером.", 'ai');
            } finally {
                loader.style.display = 'none';
            }
        }

        function addMsg(text, role) {
            const div = document.createElement('div');
            div.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'} message-fade`;
            
            // Заменяем переносы строк на <br>
            const formattedText = text.replace(/\n/g, '<br>');

            div.innerHTML = `
                <div class="max-w-[85%] p-4 rounded-2xl text-sm ${role === 'user' ? 'bg-indigo-600' : 'bg-zinc-900 border border-white/5'}">
                    ${formattedText}
                </div>
            `;
            document.getElementById('chat').appendChild(div);
            document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
        }

        // Отправка по Enter
        document.getElementById('userInput').addEventListener('keypress', (e) => {
            if(e.key === 'Enter') handleSend();
        });
    </script>
</body>
</html>
