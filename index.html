<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroEngine Monolith | Core v2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        
        body { background: #050505; color: #e5e7eb; font-family: 'Inter', sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        #chat { flex: 1; overflow-y: auto; padding: 25px; scrollbar-width: none; }
        
        /* Кастомные уведомления вместо alert */
        #notify-container { position: fixed; top: 20px; right: 20px; z-index: 10000; display: flex; flex-direction: column; gap: 10px; }
        .toast { background: #111; border: 1px solid #333; padding: 12px 20px; border-radius: 12px; font-size: 12px; color: #fff; animation: slideIn 0.3s ease-out forwards; }
        
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        .input-area { background: #0a0a0a; border-top: 1px solid #1a1a1a; padding: 20px; }
        input[type="text"] { background: #111; border: 1px solid #222; border-radius: 16px; padding: 14px 20px; width: 100%; color: #fff; outline: none; border: 1px solid #4f46e533; }
        input[type="text"]:focus { border-color: #4f46e5; box-shadow: 0 0 15px #4f46e522; }

        .ai-bubble { background: #0f0f0f; border: 1px solid #1f1f1f; border-radius: 20px 20px 20px 4px; }
        .user-bubble { background: #4f46e5; border-radius: 20px 20px 4px 20px; }
        
        .engine-status { font-family: 'JetBrains Mono', monospace; font-size: 10px; color: #4f46e5; text-transform: uppercase; letter-spacing: 1px; }
        
        img, video { border-radius: 14px; margin-top: 12px; border: 1px solid #333; transition: 0.3s; }
        img:hover { border-color: #4f46e5; }
    </style>
</head>
<body>

    <div id="notify-container"></div>

    <header class="h-20 px-8 flex items-center justify-between border-b border-white/5 bg-black/80 backdrop-blur-xl">
        <div class="flex flex-col">
            <div class="flex items-center gap-3">
                <div class="w-2 h-2 rounded-full bg-indigo-500 animate-pulse"></div>
                <h1 class="font-bold text-sm tracking-[0.2em] uppercase">NeuroEngine <span class="text-indigo-500">Monolith</span></h1>
            </div>
            <span class="engine-status mt-1">Status: Core Active / Cloud Sync 100%</span>
        </div>
        <div class="flex gap-4">
             <i class="fas fa-microchip text-zinc-700"></i>
             <i class="fas fa-server text-zinc-700"></i>
        </div>
    </header>

    <div id="chat" class="space-y-6">
        <div class="ai-bubble p-5 text-sm leading-relaxed max-w-[80%] border-indigo-500/10">
            [CORE]: Движок запущен на GitHub Pages. Все внешние аллерты подавлены. <br>
            Готов к генерации текста, фото и видео в реальном времени.
        </div>
    </div>

    <div class="input-area">
        <div class="max-w-4xl mx-auto relative flex items-center gap-3">
            <input type="text" id="userInput" placeholder="Введите команду для ядра...">
            <button onclick="CoreEngine.handleRequest()" class="bg-indigo-600 hover:bg-indigo-500 w-14 h-14 rounded-2xl flex items-center justify-center transition-all active:scale-95 shadow-lg shadow-indigo-600/20">
                <i class="fas fa-bolt text-white"></i>
            </button>
        </div>
    </div>

    <script>
        /**
         * МОНОЛИТНЫЙ ДВИЖОК (Core Engine)
         * Отвечает за логику, связь с API и подавление системных окон
         */
        const CoreEngine = {
            // Конфигурация движка
            config: {
                textNode: "https://text.pollinations.ai/",
                mediaNode: "https://pollinations.ai/p/",
                version: "2.0.4-turbo"
            },

            // Система кастомных уведомлений
            notify(msg) {
                const container = document.getElementById('notify-container');
                const toast = document.createElement('div');
                toast.className = 'toast';
                toast.innerHTML = `<i class="fas fa-info-circle mr-2 text-indigo-500"></i> ${msg}`;
                container.appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
            },

            // Главный обработчик
            async handleRequest() {
                const input = document.getElementById('userInput');
                const prompt = input.value.trim();
                if (!prompt) return;

                this.renderMessage(prompt, 'user');
                input.value = "";
                
                const loaderId = this.addLoader();
                const lowPrompt = prompt.toLowerCase();

                try {
                    // Распознавание типа задачи
                    if (lowPrompt.includes("нарисуй") || lowPrompt.includes("картинка")) {
                        await this.generateMedia(prompt, 'image', loaderId);
                    } 
                    else if (lowPrompt.includes("видео") || lowPrompt.includes("анимация")) {
                        await this.generateMedia(prompt, 'video', loaderId);
                    } 
                    else {
                        await this.generateText(prompt, loaderId);
                    }
                } catch (err) {
                    this.notify("Ошибка ядра: " + err.message);
                    document.getElementById(loaderId).remove();
                }
            },

            async generateText(prompt, loaderId) {
                const response = await fetch(`${this.config.textNode}${encodeURIComponent(prompt)}?model=openai&system=Ты Monolith Core. Отвечай как продвинутый ИИ.`);
                const text = await response.text();
                document.getElementById(loaderId).remove();
                this.renderMessage(text, 'ai');
            },

            async generateMedia(prompt, type, loaderId) {
                const cleanPrompt = prompt.replace(/(нарисуй|картинка|видео|анимация)/gi, "").trim();
                const seed = Math.floor(Math.random() * 100000);
                const url = type === 'image' 
                    ? `${this.config.mediaNode}${encodeURIComponent(cleanPrompt)}?width=1024&height=1024&seed=${seed}&model=flux`
                    : `${this.config.mediaNode}${encodeURIComponent(cleanPrompt)}?model=video&seed=${seed}`;

                document.getElementById(loaderId).remove();
                this.renderMedia(url, type, cleanPrompt);
                this.notify(`${type === 'image' ? 'Изображение' : 'Видео'} сгенерировано`);
            },

            renderMessage(text, role) {
                const chat = document.getElementById('chat');
                const div = document.createElement('div');
                div.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'} animate-in fade-in slide-in-from-bottom-2 duration-300`;
                div.innerHTML = `<div class="max-w-[85%] p-4 text-sm ${role === 'user' ? 'user-bubble shadow-xl shadow-indigo-500/20' : 'ai-bubble'}">${text.replace(/\n/g, '<br>')}</div>`;
                chat.appendChild(div);
                chat.scrollTop = chat.scrollHeight;
            },

            renderMedia(url, type, prompt) {
                const chat = document.getElementById('chat');
                const div = document.createElement('div');
                div.className = "flex justify-start animate-in zoom-in-95 duration-500";
                const content = type === 'image' 
                    ? `<img src="${url}" alt="AI Result" onload="CoreEngine.scrollBottom()">`
                    : `<video src="${url}" controls autoplay loop></video>`;
                
                div.innerHTML = `<div class="ai-bubble p-4 max-w-[85%] font-bold text-xs">РЕЗУЛЬТАТ ЯДРА: ${prompt}<br>${content}</div>`;
                chat.appendChild(div);
                this.scrollBottom();
            },

            addLoader() {
                const id = "loader-" + Date.now();
                const chat = document.getElementById('chat');
                const div = document.createElement('div');
                div.id = id;
                div.className = "flex justify-start";
                div.innerHTML = `<div class="ai-bubble p-4 flex gap-2"><div class="w-2 h-2 bg-indigo-500 rounded-full animate-bounce"></div><div class="w-2 h-2 bg-indigo-500 rounded-full animate-bounce" style="animation-delay: 0.2s"></div><div class="w-2 h-2 bg-indigo-500 rounded-full animate-bounce" style="animation-delay: 0.4s"></div></div>`;
                chat.appendChild(div);
                this.scrollBottom();
                return id;
            },

            scrollBottom() {
                const chat = document.getElementById('chat');
                chat.scrollTop = chat.scrollHeight;
            }
        };

        // Слушатель Enter
        document.getElementById('userInput').addEventListener('keypress', (e) => {
            if(e.key === 'Enter') CoreEngine.handleRequest();
        });
    </script>
</body>
</html>
